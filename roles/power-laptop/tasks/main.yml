---
#
  #
  # Configure power saving
  #
  - name: Start tuned
    service: name=tuned state=started enabled=yes
  - name: Check powertop-profile
    shell: tuned-adm list | grep powertop-profile
    register: result
    ignore_errors: True
    changed_when: "result.rc != 0"
  - name: Set profile powersave
    shell: tuned-adm profile powersave
    when: result|failed
  - name: Create powertop-profile
    shell: powertop2tuned -e -f powertop-profile
    when: result|failed
  - name: Check profile
    shell: tuned-adm active | grep desktop
    register: result
    ignore_errors: True
    changed_when: "result.rc != 0"
  - name: Set profile desktop
    shell: tuned-adm profile desktop
    when: result|failed
  - name: Copy udev rules
    copy: src=powersave.rules dest=/etc/udev/rules.d/powersave.rules mode=644 owner=root group=root
    register: result
  - name: Apply new rules
    shell: udevadm control --reload
    when: result.changed

